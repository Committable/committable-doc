## Meta-Commit

### I. Introduction

A meta-commit is a piece of verifiable metadata linked to a COMMIT (native NFT in the Committable protocol). It is verifiable in a sense that i) it is generated by trusted computing technologies (with computational proofs) and ii) any third-party can locally verify the validity of it via running a pre-specified algorithm with the commit record as input and checking whether the meta-commit matches the output. Meta-commit is designed to describe the contribution a developer made to an open-source project in a systematic and unbiased way, therefore indicate the value of a COMMIT.

### II. Specification

The following defines the standard format of meta-commit and its diegest used in Committable.

#### Standard Format

A meta-commit includes three classes of information, as below:

1. Basic Information

2. Structure Information

3. Semantic Information

##### Basic Information

- `repo`: repository URL, e.g., *"https://github.com/OpenZeppelin/openzeppelin-contracts"*

- `hash`: commit object hash (Id), e.g., *"be3cfa0f9068a1495dc524975209f223da20e148"*

- `author`: commit author information
  
  - `author.name`: name of author, e.g., *"Pascal Marco Caversaccio"*
  
  - `author.email`: email of author, e.g., *"pcaversaccio@users.noreply.github.com"*
  
  - `authortime`: time to commit by author, e.g., *"2022-04-29T16:14:18+02:00"*

- `committer`: commit committer information (may not be the same as author)
  
  - `committer.name`: name of committer, e.g., *"GitHub"*
  
  - `committer.email`: email of committer, e.g., *"noreply@github.com"*
  
  - `committer.time`: time to commit by committer, e.g., *"2022-04-29T16:14:18+02:00"*

- `message`: short explanation message of this commit, usually states what the commit is doing, e.g., *"Add custom error to \`CrossChainEnabledPolygonChild\` (#3380)\n\n"*

- `[]parents`: directly preceding commits (may be empty, one, or multiple) referenced by this commit
  
  - `parent.hash`: parent commit's hash, e.g., *"fcf35e5722847f5eadaaee052968a8a54d03622a"*

- `[]files`: a list of files that are modified (e.g., added, deleted, changed) by this commit
  
  - `file.modify_mode`: one of six modification types, i.e, `ADDED`, `DELETED`, `MODIFIED`, `RENAMED`, `COPIED`, and `TYPE_CHANGED`, e.g., *"MODIFIED"*
  
  - `file.language`: file language as decided by its file extention, e.g., *"md"*, *"sol"*
  
  - `file.before`: file attributes before this commit
    
    - `file.before.hash`: before commit file hash, e.g., *"fcf35e5722847f5eadaaee052968a8a54d03622a"*
    
    - `file.before.path`: before commit file path, e.g., *"CHANGELOG.md"*
  
  - `file.after`: file attributes after this commit
    
    - `file.after.hash`: after commit file hash, e.g, *"be3cfa0f9068a1495dc524975209f223da20e148"*
    
    - `file.after.path`: after commit file path, e.g., *"CHANGELOG.md"*
  
  - `file.stats`: file statistics
    
    - `file.stats.lines`: line statistics
      
      - `file.stats.lines.added`: number of added lines in this file, e.g., *"1"*
      
      - `file.stats.lines.deleted`: number of deleted lines in this file, e.g., *"0"*
  
  - `file.diff_url`: diff file URL, which contains diff result as output by `git diff` command when comparing before and after commit files

##### Structure Information

- `source_code`: source code level sttructure information
  
  - `[]source_code.files`: file source code structure analysis result, e.g., Abstract Syntax Tree (AST)
    
    - `source_code.file.modify_mode`: one of six modification types, the same as `file.modify_mode`
    
    - `source_code.file.language`: file language as decided by its file extention, the same as `file.language`
    
    - `source_code.file.before`: before commit file source code information
      
      - `source_code.file.before.path`: before commit file path, e.g., *"CHANGELOG.md"*
      
      - `source_code.file.before.model`: before commit analysis result
        
        - `source_code.file.before.model.type`: analysis result type, e.g., *"AST"*
        
        - `source_code.file.before.model.url`: analysis result link URL, see [example AST](examples/AST.json)
    
    - `source_code.file.after`: after commit file source code information
      
      - `source_code.file.after.path`: after commit file path, e.g., *"CHANGELOG.md"*
      
      - `source_code.file.after.model`: after commit analysis result
        
        - `source_code.file.after.model.type`: analysis result type, e.g., *"AST"*
        
        - `source_code.file.after.model.url`: analysis result link URL, see [example AST](examples/AST.json)

- `executable_code`: executable code level structure information
  
  - `[]executable_code.files`: file executable code structure analysis result, e.g., Control Flow Graph (CFG)
    
    - `executable_code.file.modify_mode`: one of six modification types, the same as `file.modify_mode`
    
    - `executable_code.file.language`: file language as decided by its file extention, the same as `file.language`
    
    - `executable_code.file.before`: before commit file executable code information
      
      - `executable_code.file.before.path`: before commit file path, e.g., *"CHANGELOG.md"*
      
      - `executable_code.file.before.model`: before commit analysis result
        
        - `executable_code.file.before.model.type`: analysis result type, e.g., *"CFG"*
        
        - `executable_code.file.before.model.url`: analysis result link URL, see [example CFG](examples/CFG.json)
    
    - `executable_code.file.after`: after commit file executable code information
      
      - `executable_code.file.after.path`: after commit file path, e.g., *"CHANGELOG.md"*
      
      - `executable_code.file.after.model`: after commit analysis result
        
        - `executable_code.file.after.model.type`: analysis result type, e.g., *"CFG"*
        
        - `executable_code.file.after.model.url`: analysis result link URL, see [example CFG](examples/CFG.json)

##### Semantic Information

- `executable_code`: executable code level semantic information
  
  - `[]executable_code.files`: file executable code semantic analysis result, e.g., Dependency Graph (DG)
    
    - `executable_code.file.modify_mode`: one of six modification types, the same as `file.modify_mode`
    
    - `executable_code.file.language`: file language as decided by its file extention, the same as `file.language`
    
    - `executable_code.file.before`: before commit file executable code information
      
      - `executable_code.file.before.path`: before commit file path, e.g., *"CHANGELOG.md"*
      
      - `executable_code.file.before.model`: before commit analysis result
        
        - `executable_code.file.before.model.type`: analysis result type, e.g., *"DG"*
        
        - `executable_code.file.before.model.url`: analysis result link URL, see [example DG](examples/DG.json)
    
    - `executable_code.file.after`: after commit file executable code information
      
      - `executable_code.file.after.path`: after commit file path, e.g., *"CHANGELOG.md"*
      
      - `executable_code.file.after.model`: after commit analysis result
        
        - `executable_code.file.after.model.type`: analysis result type, e.g., *"DG"*
        
        - `executable_code.file.after.model.url`: analysis result link URL, see [example DG](examples/DG.json)

- `github`: git community information provided by Github, which complements plain git attributes with social features
  
  - `[]github.issues`: Github Issues associated with this commit
    
    - `github.issue.type`: Issue type, one of two categories, i.e., `ISSUE`, `PULL_REQUEST`, e.g., *"PULL_REQUEST"* 
    
    - `github.issue.number`: Issue number, e.g., *"3380"*
    
    - `github.issue.title`: Issue title, e,g., *"Add custom error to \`CrossChainEnabledPolygonChild\`"*
    
    - `github.issue.category`: Issue category, one of eight categories, i.e., `FEATURE`, `DOC`, `FIX`, `IMPROVE`, `MAINTAIN`, `TEST,` `CLEAN`, and `MISC`, e.g., *"MISC"*
    
    - `github.issue.priority`: Issue priority, one of five categories, i.e., `LOW_PLUS`, `LOW`, `MID`, `HIGH`, and `HIGH_PLUS`, e.g., *"LOW_PLUS_"*
    
    - `github.issue.git_url`: Issue URL as responsed by Github, e.g., *"https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/pulls/3380"*

#### Meta-Commit Digest

While being complete and comprehensive, Meta-Commit in its raw version (as described above) may seem tedious and cumbersome for the vast non-technical users. To make it more acceptable for these users, we introduce the so called Meta-Commit Digest as a refined and more user-friendly version of Meta-Commit.

Like standard Meta-Commit, Meta-Commit Digest can be divided into three parts:

1. Basic Feature

2. Structure Feature

3. Semantic Feature

##### Basic Feature

- `repo`: repository URL, e.g., *"https://github.com/OpenZeppelin/openzeppelin-contracts"*

- `hash`: commit object hash (Id), e.g., *"be3cfa0f9068a1495dc524975209f223da20e148"*

- `lines`: line statistics of this commit as a while
  
  - `lines.added`: number of added lines by this commit, e.g., *"3"*
  
  - `lines.deleted`: number of deleted lines by this commit, e.g., *"2"*

- `files`: file statistics of this commit as a while
  
  - `files.added`: number of added files by this commit, e.g., *"0"*
  
  - `files.deleted`: number of deleted files by this commit, e.g., *"0"*
  
  - `files.modified`: number of modified files by this commit, e.g., *"2"*
  
  - `files.renamed`: number of renamed files by this commit, e.g., *"0"*
  
  - `files.copied`: number of copied files by this commit, e.g., *"0"*
  
  - `files.type_changed`: number of type changed files by this commit, e.g., *"0"*

##### Structure Feature

- `sequences`: number of sequence structure changes
  
  - `sequences.source_code`: sequence structure changes in source code, e.g., *"0"*
  
  - `sequences.executable_code`: sequence structure changes in executable code, e.g., *"0"*

- `selections`: number of selection structure (e.g., `if`, `else`, `switch`) changes
  
  - `selections.source_code`: selection structure changes in source code, e.g., *"0"*
  
  - `selections.executable_code`: selection structure changes in executable code, e.g., *"0"*

- `repetitions`: number of repetition structure (e.g., `for`, `do while`) changes
  
  - `repetitions.source_code`: repetition structure changes in source code, e.g., *"0"*
  
  - `repetitions.executable_code`: repetition structure changes in executable code, e.g., *"0"*

##### Semantic Feature

- `control_flow`: number of control flow changes, e.g., *"0"*

- `data_flow`: number of data flow changes, e.g., *"0"*

### III. Example: OpenZeppelin

The following Meta-Commit example is based on commit `be3cfa0f9068a1495dc524975209f223da20e148` from OpenZeppelin smart contract repository hosted at `https://github.com/OpenZeppelin/openzeppelin-contracts.git`:

```json
{
    "basic": {
        "repo": "https://github.com/OpenZeppelin/openzeppelin-contracts",
        "hash": "be3cfa0f9068a1495dc524975209f223da20e148",
        "author": {
            "name": "Pascal Marco Caversaccio",
            "email": "pcaversaccio@users.noreply.github.com",
            "time": "2022-04-29T16:14:18+02:00"
        },
        "committer": {
            "name": "GitHub",
            "email": "noreply@github.com",
            "time": "2022-04-29T16:14:18+02:00"
        },
        "message": "Add custom error to `CrossChainEnabledPolygonChild`  (#3380)\n\n",
        "git_url": "",
        "parents": [
            {
                "hash": "fcf35e5722847f5eadaaee052968a8a54d03622a",
            }
        ],
        "files": [
            {
                "modify_mode": "MODIFIED",
                "language": "md",
                "before": {
                    "hash": "fcf35e5722847f5eadaaee052968a8a54d03622a",
                    "path": "CHANGELOG.md",
                },
                "after": {
                    "hash": "be3cfa0f9068a1495dc524975209f223da20e148",
                    "path": "CHANGELOG.md",
                },
                "stats": {
                    "lines": {
                        "added": "1",
                        "deleted": "0"
                    }
                },
                "diff_url": "diffs/github.com/OpenZeppelin/openzeppelin-contracts/be3cfa0f9068a1495dc524975209f223da20e148/CHANGELOG.md/diff"
            },
            {
                "modify_mode": "MODIFIED",
                "language": "sol",
                "before": {
                    "hash": "fcf35e5722847f5eadaaee052968a8a54d03622a",
                    "path": "contracts/crosschain/polygon/CrossChainEnabledPolygonChild.sol",
                },
                "after": {
                    "hash": "be3cfa0f9068a1495dc524975209f223da20e148",
                    "path": "contracts/crosschain/polygon/CrossChainEnabledPolygonChild.sol",
                },
                "stats": {
                    "lines": {
                        "added": "2",
                        "deleted": "2"
                    }
                },
                "diff_url": "diffs/github.com/OpenZeppelin/openzeppelin-contracts/be3cfa0f9068a1495dc524975209f223da20e148/contracts/crosschain/polygon/CrossChainEnabledPolygonChild.sol/diff"
            }
        ]
    },
    "structure": {
        "source_code": {
            "files": [
                {
                    "modify_mode": "MODIFIED",
                    "language": "md",
                    "before": {
                        "path": "CHANGELOG.md",
                        "model": {
                            "type": "AST",
                            "url": "https://storage.googleapis.com/committable/analysis/a6ee42e0-2939-4b9e-9a71-a4f6362bea54.json"
                        }
                    },
                    "after": {
                        "path": "CHANGELOG.md",
                        "model": {
                            "type": "AST",
                            "url": "https://storage.googleapis.com/committable/analysis/a8b72127-8666-4c47-b18e-1bfcb6b5c715.json"
                        }
                    }
                },
                {
                    "modify_mode": "MODIFIED",
                    "language": "sol",
                    "before": {
                        "path": "contracts/crosschain/polygon/CrossChainEnabledPolygonChild.sol",
                        "model": {
                            "type": "AST",
                            "url": "https://storage.googleapis.com/committable/analysis/cf1a3493-23f8-4240-9142-cd31319d6765.json"
                        }
                    },
                    "after": {
                        "path": "contracts/crosschain/polygon/CrossChainEnabledPolygonChild.sol",
                        "model": {
                            "type": "AST",
                            "url": "https://storage.googleapis.com/committable/analysis/bbca3116-c115-4b34-b626-5d917becb932.json"
                        }
                    }
                }
            ]
        },
        "executable_code": {
            "files": [
                {
                    "modify_mode": "MODIFIED",
                    "language": "md",
                    "before": {
                        "path": "CHANGELOG.md",
                        "model": {
                            "type": "CFG",
                            "url": ""
                        }
                    },
                    "after": {
                        "path": "CHANGELOG.md",
                        "model": {
                            "type": "CFG",
                            "url": ""
                        }
                    }
                },
                {
                    "modify_mode": "MODIFIED",
                    "language": "sol",
                    "before": {
                        "path": "contracts/crosschain/polygon/CrossChainEnabledPolygonChild.sol",
                        "model": {
                            "type": "CFG",
                            "url": "https://storage.googleapis.com/committable/analysis/84767620-ebd3-44ac-994a-5c63c15612c7.json"
                        }
                    },
                    "after": {
                        "path": "contracts/crosschain/polygon/CrossChainEnabledPolygonChild.sol",
                        "model": {
                            "type": "CFG",
                            "url": "https://storage.googleapis.com/committable/analysis/29ee296a-e417-46ee-a6db-dced9bae70b6.json"
                        }
                    }
                }
            ]
        }
    },
    "semantics": {
        "executable_code": {
            "files": [
                {
                    "modify_mode": "MODIFIED",
                    "language": "md",
                    "before": {
                        "path": "CHANGELOG.md",
                        "model": {
                            "type": "SSG",
                            "url": ""
                        }
                    },
                    "after": {
                        "path": "CHANGELOG.md",
                        "model": {
                            "type": "SSG",
                            "url": ""
                        }
                    }
                },
                {
                    "modify_mode": "MODIFIED",
                    "language": "sol",
                    "before": {
                        "path": "contracts/crosschain/polygon/CrossChainEnabledPolygonChild.sol",
                        "model": {
                            "type": "SSG",
                            "url": "https://storage.googleapis.com/committable/analysis/80a29f67-ba8b-42d6-9da2-5fcd00d7efa6.json"
                        }
                    },
                    "after": {
                        "path": "contracts/crosschain/polygon/CrossChainEnabledPolygonChild.sol",
                        "model": {
                            "type": "SSG",
                            "url": "https://storage.googleapis.com/committable/analysis/e2f53523-ac98-4315-94fa-e35172fb81d0.json"
                        }
                    }
                }
            ]
        },
        "github": {
            "issues": [
                {
                    "type": "PULL_REQUEST",
                    "number": "3380",
                    "title": "Add custom error to `CrossChainEnabledPolygonChild` ",
                    "category": "MISC",
                    "priority": "LOW_PLUS",
                    "git_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/pulls/3380"
                }
            ]
        }
    },
    "digest": {
        "basic": {
            "repo": "https://github.com/OpenZeppelin/openzeppelin-contracts.git",
            "hash": "be3cfa0f9068a1495dc524975209f223da20e148",
            "lines": {
                "added": "3",
                "deleted": "2"
            },
            "files": {
                "added": "0",
                "deleted": "0",
                "modified": "2",
                "renamed": "0",
                "copied": "0",
                "type_changed": "0"
            }
        },
        "structure": {
            "sequences": {
                "source_code": "0",
                "executable_code": "0"
            },
            "selections": {
                "source_code": "0",
                "executable_code": "0"
            },
            "repetitions": {
                "source_code": "0",
                "executable_code": "0"
            }
        },
        "semantics": {
            "control_flow": "0",
            "data_flow": "0"
        }
    }
}
```
